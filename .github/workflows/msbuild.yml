name: MSBuild
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
jobs:
  build:
    runs-on: windows-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Install Vulkan SDK
      run: |
        $env:VULKAN_SDK_VERSION="1.2.176.1"
        $env:VULKAN_SDK="C:\VulkanSDK\${VULKAN_SDK_VERSION}"
        Invoke-WebRequest -Uri "https://sdk.lunarg.com/sdk/download/${VULKAN_SDK_VERSION}/windows/vulkansdk-${VULKAN_SDK_VERSION}-offline.exe" -OutFile "vulkansdk.exe"
        Start-Process .\vulkansdk.exe -ArgumentList '/S', '/D=C:\VulkanSDK' -Wait
        Remove-Item .\vulkansdk.exe
    - name: Install GLFW
      run: |
        git clone --depth=1 https://github.com/glfw/glfw.git
        cd glfw
        mkdir build && cd build
        cmake .. -DCMAKE_INSTALL_PREFIX=C:/glfw
        cmake --build . --config Release --target install
        cd ../.. && rm -rf glfw
    - name: Install STB
      run: |
        git clone --depth=1 https://github.com/nothings/stb.git
    - name: Install GLM
      run: |
        git clone --depth=1 https://github.com/g-truc/glm.git
    - name: Set up MSVC compiler environment
      shell: cmd
      run: |
        "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvars64.bat"
    - name: Build the project
      shell: cmd
      run: |
        cl.exe /EHsc /I C:\glfw\include /I C:\VulkanSDK\${VULKAN_SDK_VERSION}\Include /I glm /I stb -std:c++latest /Fe:main.exe *.cpp *.h
